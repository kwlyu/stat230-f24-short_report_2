---
title: "Short Report 2 Code"
author: "Anna Ursin and Kunwu Lyu"
date: "`r Sys.Date()`"
output: pdf_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = T)
library(tidyverse)
library(ggplot2)
library(GGally)
library(broom)
library(patchwork)
library(ggResidpanel)
library(purrr)
```


```{r}
## Data Wrangling

wine_dat <- read.csv("https://www.math.carleton.edu/ckelling/data/wine_project.csv")
glimpse(wine_dat)


ggpairs(wine_dat)
```

```{r}
##EDA: boxplots
library(ggplot2)
ggplot(wine_dat, aes(y = fixed.acidity)) + geom_boxplot() + ggtitle("Fixed Acidity")
ggplot(wine_dat, aes(y = volatile.acidity)) + geom_boxplot() + ggtitle("Volatile Acidity")
ggplot(wine_dat, aes(y = citric.acid)) + geom_boxplot() + ggtitle("Citric Acid")
ggplot(wine_dat, aes(y = residual.sugar)) + geom_boxplot() + ggtitle("Residual Sugar")
ggplot(wine_dat, aes(y = chlorides)) + geom_boxplot() + ggtitle("Chlorides")
ggplot(wine_dat, aes(y = free.sulfur.dioxide)) + geom_boxplot() + ggtitle("Free Sulfur Dioxide")
ggplot(wine_dat, aes(y = total.sulfur.dioxide)) + geom_boxplot() + ggtitle("Total Sulfur Dioxide")
ggplot(wine_dat, aes(y = density)) + geom_boxplot() + ggtitle("Density")
ggplot(wine_dat, aes(y = pH)) + geom_boxplot() + ggtitle("pH")
ggplot(wine_dat, aes(y = sulphates)) + geom_boxplot() + ggtitle("Sulphates")
ggplot(wine_dat, aes(y = alcohol)) + geom_boxplot() + ggtitle("Alcohol")
ggplot(wine_dat, aes(y = quality)) + geom_boxplot() + ggtitle("Quality")
ggplot(wine_dat, aes(x = color, fill = color)) +
  geom_bar(position = "dodge")
```


```{r}
#dist of quality scores
ggplot(wine_dat, aes(x = quality)) + 
  geom_bar() + 
  labs(title = "Distribution of Wine Quality Scores")
```

```{r}
#correlation matrix
library(corrplot)

wine_numeric <- wine_dat %>% select(-color)

corr_matrix <- cor(wine_numeric, use = "complete.obs")
corrplot(corr_matrix, method = "color")
```

```{r}
# Scatterplot matrix
ggpairs(data = wine_dat, columns = c("alcohol", "sulphates", "pH", "residual.sugar", "color", "quality"))

create_plot <- function(var_name) {
  ggplot(data = wine_dat, 
         aes_string(x = var_name, y = "quality", color = "color")) +
    geom_point() +
    geom_smooth(method = "lm", se = FALSE) + 
    labs(title = paste("Quality vs", var_name))
}

variable_names <- c("alcohol", "sulphates", "pH", "residual.sugar")
plot_list <- map(variable_names, create_plot)

plot_grid <- wrap_plots(plot_list, ncol = 2)
plot_grid

wine_lm_base <- lm(quality ~ alcohol + sulphates + residual.sugar + pH*color, data = wine_dat)

summary(wine_lm_base)


resid_xpanel(wine_lm_base)
resid_panel(wine_lm_base)
```

```{r}
#Basefunction
wine_lmbase <- lm(quality ~ alcohol + sulphates + residual.sugar + pH, data = wine_dat)
summary(wine_lmbase)
wine_lminteraction <- lm(quality ~ alcohol + sulphates + residual.sugar + pH*color, data = wine_dat)
summary(wine_lminteraction)
```

```{r}
#checking for influential observations



ggplot(AUGwine_lminteraction, aes(x = 1:nrow(AUGwine_lminteraction), y = .cooksd)) + geom_point() + 
  labs(y = "Cook's Distance", x = "Index")

wine_datrow <- wine_dat %>% mutate(case = row_number())
AUGwine_lminteraction <- augment(wine_lminteraction, data = wine_datrow)

high_L <- AUGwine_lminteraction %>% arrange(desc(.hat)) %>% head()
high_SR <- AUGwine_lminteraction %>% arrange(desc(.std.resid)) %>% head()
high_CD <- AUGwine_lminteraction %>% arrange(desc(.cooksd)) %>% head()
high_L
high_SR
#case 2374 is high, above 4
high_CD
```


